## 날짜: 2025-03-06

### 스크럼
- 학습 목표 1 : 어제 구현한 캐시를 이용하도록 랭체인에 연결
- 학습 목표 2 : api 명세서에 맞춰 응답 분리 (api 응답 조정)

### 새로 배운 내용
#### 주제 1: 어제 구현한 캐시를 이용하도록 랭체인에 연결
- 키워드 검색의 경우, isKeyword 변수를 만들어 불리언 값을 저장해둔다.
- 키워드 검색이면 캐시에서 미리 저장된 응답을 불러와서 이용한다.
- state에 update_state를 이용해서 수동으로 대화 내역 반영해준다.

#### 주제 2: api 명세서에 맞춰 응답 분리
- 기존에는 식당 추천 요청과 일반 대화 요청에서 모두 벡터DB 검색을 진행했다.
- 이는 작업 논리 상 맞지 않다. 일반 대화 요청의 경우, 추천 식당 리스트를 반영하면 안된다.
- 만약 식당 추천 요청에 응답한 경우, state[“messages”][-2]는 tool_calls에 해당한다.
- 이를 이용해서 ask의 리턴값을 json 형식으로 응답과 식당 추천 요청인지 여부를 반환한다.
- main.py에서 이를 이용해서 벡터DB 검색해 api 명세서를 채운다. (식당 추천 요청이 아니면 추천 식당 리스트 부분을 응답에서 비운다.)

### 오늘의 도전 과제와 해결 방법
- 도전 과제 1: 키워드 검색인지 여부를 언제 판단할건지 결정
	- workflow가 시작된 후에 판단하면 흐름 관리가 복잡할 것이라 예상됨.
	- 키워드 검색은 workflow를 거치지 않고 캐시 이용함.
	- 이때, workflow를 이용하지 않기 때문에 state를 수동으로 업데이트해줘야 함.
- 도전 과제 2: 식당 추천 요청이었는지 여부를 어떻게 판단할 것인가
	- 클래스 변수로 isRecommend를 만들까 했는데 그렇게 하면 thread별로 관리가 안될 것이라 판단.
	- state 로그를 찍어보니 지난 메세지에서 tool_calls 부분을 찾을 수 있었다.
	- 이를 이용해서 식당 추천 요청인지 여부를 서버 파일에 전달함.

### 오늘의 회고
- 필요한 기능들을 하나씩 추가하니 뿌듯하다.
- 다만, 빠른 배포를 위해 기능 추가를 우선적으로 하다보니 리팩토링 작업이 필요할 듯 하다.
- chatgpt api 비용과 관련해서 ai팀 회의를 해서 지원을 받을 수 있도록 조정했다.
- 정상 작용 체크해야 할 기능: 키워드 검색에 대해서도 추천 식당 리스트가 api 응답에 반영되는지
 - 현재 구현은 해둔 상태로 작동 체크가 필요하다.